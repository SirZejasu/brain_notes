---
tags:
  - dba
  - sql
---
> [!hint] Relevantes
    > Als Datenbank und Relationales DBMS nutzen wir [PostgreSQL](https://www.postgresql.org/) 15.

# SQL
> [!question] Was ist SQL?
    > Basierend auf [[Relationale Algebra]], ist es ursprünglich auf die englische Sprache angelehnt und wurde als End-user Sprache entwickelt.
    > 
    > Nachfolger von SEQUEL
    > 
    > ANSI und ISO standardtisiert. Systemabhängige Abwandlungen existieren.
    > 
    > SQL deckt mehrere Teile von [[Datenbank - Allgemein#Aufgaben rund um ein DBMS|Aufgaben rund um ein DBMS]]
    > 
    > In den 70er Jahren von Edgar F. Codd, Donald D. Chamberlin und Raymond F. Boyce entwickelt.

## Allgemeine SQL-Definitionen

| Name        | Definition                                                                                                             |
| ----------- | ---------------------------------------------------------------------------------------------------------------------- |
| Primary Key | = Primärschlüssel<br><br>Einzigartige ID innerhalb einer Datenbanktabelle                                              |
| Foreign Key | = Fremdschlüssel<br><br>ID innerhalb einer Tabelle, die auf ein Element in einer anderen Datebanktabelle referenziert. |
# Datentypen

| Datentypen                     | Definition                                                                                                                                                                  |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| INTEGER, SMALLINT, INT         | ganzzahliger Wert (16 Bit)                                                                                                                                                  |
| DECIMAL(p, q)<br>NUMERIC(p, q) | Festkommazahl (p lang, q Nachkommastellen) NUMERIC(p,q)                                                                                                                     |
| BOOL, BOOL                     |                                                                                                                                                                             |
| CHAR(n)                        |                                                                                                                                                                             |
| Varchar(n)                     |                                                                                                                                                                             |
| DATE                           | Datum, Format: 'YYYY-MM-DD'                                                                                                                                                 |
| TIME                           | Zeit, Format: 'HH:MM:SS.S'                                                                                                                                                  |
| TIMESTAMP                      | Nanosekunden-genaue Zeitpunkte<br><br>Zeitstempel, Format: 'YYYY-MM-DD HH:MM:SS.S'<br><br>❗*Hinweis*: Es gibt keine normalisierte Repräsentation von Zeiten in Datenbanken. |
| NOT-NULL                       |                                                                                                                                                                             |

# Typische SQL-Befehle
![[Pasted image 20250922153015.png]]

## Select-Operation (Datenabfrage)
![[Pasted image 20250922162338.png|500]]

| Name           | Bedeutung                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Beispiel                                                                                                                     |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| SELECT         | ![[Pasted image 20250922185247.png]]<br><br>Die Relationen $R_1, ...,R_2$ werden zu dem kartesischen Produkt $R_1$ x . . . x $R_m$<br><br>Die Bedingung C filtern die Zeilen $R_1$ x . . . x $R_m$<br><br>Die Attribute $A_1$ ... $A_n$ kennzeichnen die Spalten, die im Ergebnis zurückgeben werden.<br><br>Auswahl von (mehreren) Spalten oder Tabellen.                                                                                                                                          | ![[Pasted image 20250922185623.png]]<br><br>![[Pasted image 20250922185639.png]]                                             |
| FROM           | Gibt die verwendete Relationen (mit Umbenuennungen) an.                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                              |
| WHERE          | **optionale** Bedingung, die die gesuchten Daten filtern.<br>Selektions- und Verbundbedingungen, als auch geschahtelte Anweisungen erlaubt.<br><br>(Unter anderem) Erlaubte Ausdrücke:<br>- Vergleichsoperationen: =,<>, <, >, <=, >=<br>- Konstanten und Attribute (müssen nicht im SELECT benannt werden)<br>- Artihmetische Ausdrücke (Bsp. Betrag * 2 <= MaxBetrag)<br><br>Equivalent zu [[Relationale Algebra - Allgemein#Weitere Algebra Operationen\|Selektion]] in der Relationalen Algebra | ![[Pasted image 20250922190229.png]]                                                                                         |
| GROUP BY       | Zeilen in disjunkte Gruppen gruppieren.<br><br>Es dürfen nur Attribute im SELECT-Teil genannt werden, die auch im GROUP BY auftauchen.                                                                                                                                                                                                                                                                                                                                                              | ![[Pasted image 20250929210027.png]]<br><br>![[Pasted image 20250929210432.png]]<br><br>![[Pasted image 20250929211036.png]] |
| HAVING         | Nur in Kombination mit GROUP BY<br><br>Es können dieselben Ausdrücke verwendet werden wie in dem SELECT Teil (d.h. die Aggregierungen und die Attribute aus GROUP BY)                                                                                                                                                                                                                                                                                                                               | ![[Pasted image 20250929211317.png]]                                                                                         |
| ORDER BY       | Daten sortieren aufsteigend in lexikographischer Reihenfolge.<br><br>Keine Verwendung in Subanfragen.<br><br>                                                                                                                                                                                                                                                                                                                                                                                       | ![[Pasted image 20250929205150.png]]                                                                                         |
| DESC           | Absteigende Reihenfolge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ![[Pasted image 20251002144211.png]]                                                                                         |
| AS (Variablen) | Optional.<br><br>Zur besseren Lesbarkeit können in einer SQL-Anfrage auch Variablen (bzw. Aliase) eingeführt werden.<br><br>Es wird mit "AS" deklariert. (s. Beispiel)<br>Ohne Deklaration ist der Alias der ursprüngliche Name.<br><br>Aliase können in Verbindung mit arithmetiwschen Ausdrücken, Konstanten und Umbenennungen verwendet werden.<br><br>Equivalent zu [[Relationale Algebra - Allgemein#Weitere Algebra Operationen\|Umbenennung]] in der Relationalen Algebra<br>                | ![[Pasted image 20250922185814.png]]<br><br>![[Pasted image 20250922190146.png]]<br><br>![[Pasted image 20250922190203.png]] |
| IN             | Durch das Schlüsselwort IN wird getestet ob ein Attribut in der Ergebnisrelation der angegebenen geschachtelten Anfrage liegt (oder nicht liegt, NOT).                                                                                                                                                                                                                                                                                                                                              | ![[Pasted image 20250922191902.png]]                                                                                         |
| DISTINCT       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ![[Pasted image 20250929194147.png]]                                                                                         |
| LIKE           | The `LIKE` operator is used in a `WHERE` clause to search for a specified pattern in a column.                                                                                                                                                                                                                                                                                                                                                                                                      | ![[Pasted image 20251002123614.png]]<br><br>                                                                                 |

### Kartesisches Produkt in SQL
> [!NOTE]
    > ![[Pasted image 20250922191505.png]]
    > ![[Pasted image 20250923202650.png]]

| Name                          | Erklärung                                                                                                                                                                                                                                                      | Beispiel                                                                         |
| ----------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| JOIN / INNER JOIN             | [[#Schnittmengen / Kartesisches Produkt]] von zwei Tabellen.<br><br>Die Verwendung von JOIN ON-Bedingungen statt<br>"WHERE f.Film-ID = r.Film-ID" ermöglicht eine optimierte Abfrageleistung durch die Verknüpfung der Tabellen direkt auf Datenbankebene.<br> | ![[Pasted image 20250922191912.png]]<br><br>![[Pasted image 20250929195815.png]] |
| LEFT OUTER JOIN / LEFT JOIN   |                                                                                                                                                                                                                                                                | ![[Pasted image 20250929200031.png]]                                             |
| RIGHT OUTER JOIN / RIGHT JOIN |                                                                                                                                                                                                                                                                | ![[Pasted image 20250929200045.png]]                                             |
| Sternchen '*'                 | Variante mit der Select-Operation.<br><br>Equivalent zu [[Relationale Algebra - Allgemein### Weitere Algebra Operationen\|Kartesisches Produkt]] in der Relationalen Algebra.<br>                                                                              | ![[Pasted image 20250929193023.png]]                                             |
| UNION                         | Variante mit der Select-Operation<br><br>Equivalent zu [[Relationale Algebra - Allgemein#Mengenoperationen\|Vereinigung]] in der Relationalen Algebra<br><br>                                                                                                  | ![[Pasted image 20250929192043.png]]                                             |
| INTERSECT                     | Variante mit der Select-Operation<br><br>Equivalent zu [[Relationale Algebra - Allgemein#Mengenoperationen\|Schnittmenge]] in der Relationalen Algebra                                                                                                         | ![[Pasted image 20250929192053.png]]                                             |
| EXCEPT                        | Variante mit der Select-Operation<br><br>Equivalent zu [[Relationale Algebra - Allgemein#Mengenoperationen\|Mengendifferenz]] in der Relationalen Algebra                                                                                                      | ![[Pasted image 20250929192104.png]]                                             |
### Geschachtelte Anfragen

| Name       | Bedeutung                                                                                                                                                                                                                                     | Beispiel                             |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| EXISTS     |                                                                                                                                                                                                                                               |                                      |
| NOT EXISTS | Mit dem Schlüsselwort NOT EXISTS können wir Anfragen schreiben, die<br>testen ob das Ergebnis einer Subanfrage leer ist.<br><br>In der Subanfrage können Aliase verwendet werden, die in der äußeren Anfrage definiert wurden.                | ![[Pasted image 20250929202441.png]] |
| ALL        | - Hier wird ein einziger Wert mit allen Werten in der Ergebnismenge der Subanfrage verglichen.                                                                                                                                                | ![[Pasted image 20250929203459.png]] |
| ANY        | Der Operator ANY wird analog verwendet und testet ob mindestens ein Wert in der Menge die Bedingung erfüllt. (SOME kann synonym<br>verwendet werden.)<br><br>![[Pasted image 20250929203956.png]]<br><br>![[Pasted image 20250929204006.png]] |                                      |

## Update-Operationen (Datenänderung)


| Name                     | Verwendung                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Beispiele                                                                             |
| ------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| UPDATE                   | ![[Pasted image 20250922183929.png]]<br><br>Änderungen von bereits bestehenden Daten in Tabellen.<br><br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ![[Pasted image 20250922184105.png]]                                                  |
| DELETE FROM              | ![[Pasted image 20250922184122.png]]<br><br>Löschen von Werten in einer Datenbanktabelle.<br><br>Wird keine WHERE-Bedingung angegeben, werden alle Zeilen in der Tabelle gelöscht. Die Tabelle bleibt erhalten.<br><br>Wenn keine WHERE Kondition definiert ist, werden alle Daten in einer Tabelle gelöscht.<br><br>Tabelle bleibt erhalten.<br><br>                                                                                                                                                                                                                                                                                                           | ![[Pasted image 20250922184212.png]]                                                  |
| INSERT INTO              | ![[Pasted image 20250922183214.png\|400]]<br>Wert in einer bereits bestehenden Tabelle hinzufügen.<br><br>Attribute müssen in derselben Reihenfolge wie die Spaltenreihenfolge der Tabelle angegeben werden.<br><br>Einzelnen Spalten können ausgelassen werden. Allerdings nur wenn die ausgelassenen Spalten NULL-Werte erlauben oder mit einem Default-Wert erzeugt werden.<br><br>~~Die Spaltennamen (attribut$_1$, ... , attribut$_n$) können auch weggelassen werden. Dann müssen aber Werte für alle Spalten angegeben werden.~~<br><br>Wichtig ist hierbei, Fremdschlüssel und Primary Key anzugeben.<br>Der Primary Key wird von der DB NICHT erzeugt. | ![[Pasted image 20250922183837.png]]<br><br>![[Pasted image 20250922183903.png]]      |
| **Tabellendefinition**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                       |
| CREATE TABLE             | Tabelle erstellen<br><br>Schema:<br>![[Pasted image 20250922180334.png]]<br><br>Zwischen eckigen Klammern [. . .] stehen optionale Teile.<br><br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | ![[Pasted image 20250922180646.png\|300]]<br><br>![[Pasted image 20250922180852.png]] |
| **Tabellenänderungen**   | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                       |
| DROP TABLE               | Tabelle löschen, mitsamt Daten.<br><br>Wird zurückgewiesen, wenn Abhängigkeiten existieren.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                       |
| **Tabellenmodifikation** | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                       |
| ALTER TABLE              | The `ALTER TABLE` statement is used to add, delete, or modify columns in an existing table.<br><br>Also used to add and drop various constraints on an existing table.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ![[Pasted image 20250922182735.png\|400]]                                             |
| ADD COLUMN               | Hinzufügen einer Spalte                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | ![[Pasted image 20250922182820.png]]<br><br>![[Pasted image 20250922182957.png]]      |
| DROP COLUMN              | Entfernen einer Spalte                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ![[Pasted image 20250922182835.png]]<br><br>![[Pasted image 20250922183013.png]]      |




## Create-Operation
### Geschachtelte Anfragen

| Name                                                        | Bedeutung                                                                                                                                                                                                                                                                         | Beispiel                             |
| ----------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| CREATE TABLE [TABELLEN-NAME] <br>[ATTRIBUT EIGENSCHAFT] ... | Tabelle wird erstellt.<br>                                                                                                                                                                                                                                                        | ![[Pasted image 20251003141033.png]] |
| VIEW                                                        | Benutzersicht.<br><br>Zugriffsrechte können entsprechend gesetzt werden.<br><br>Es kann kein [[#Update-Operationen\|UPDATE]] auf View berechnet werden.<br><br>Mit DROP kann VIEW wieder gelöscht werden.<br>![[Pasted image 20250929204858.png]]<br><br>Kein Performancevorteil. | ![[Pasted image 20250929204750.png]] |
| **Benutzersichtdefinition und Sichtenentfernung**           | -                                                                                                                                                                                                                                                                                 |                                      |
| CREATE VIEW                                                 | Benutzersicht erstellen                                                                                                                                                                                                                                                           |                                      |
| DROP VIEW                                                   | Benutzersicht löschen                                                                                                                                                                                                                                                             |                                      |
# SQL-Funktionen

| Name       | Bedeutung                                                                                                                             | Beispiel                             |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| MAX(DAUER) | Aggregieren von Daten.<br><br>Weitere Aggregierungsmöglichkeiten:<br>COUNT, SUM, AVG, MIN<br><br>![[Pasted image 20250929205439.png]] | ![[Pasted image 20250929205413.png]] |

